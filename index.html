<!DOCTYPE html>
<html lang="en-us">

<style>
    .menu {
    color : #eeeeee;
    padding-right: 20px;
    }

</style>
<head>
	<meta name="generator" content="Hugo 0.74.3" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
  <title>NOTHING</title>
  <link href="http://soyum2222.github.io/css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="http://soyum2222.github.io/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
  <style type="text/css">
  
    footer.page-footer{background-image: url(http://soyum2222.github.io/images/default.png);}
  
  </style>
</head>
<body>
  <ul id="slide-out" class="side-nav">
    <li><a href="http://soyum2222.github.io"><i class="mdi-action-home left"></i>Home<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    <li><a href="http://soyum2222.github.io/categories"><i class="mdi-action-perm-media left"></i>Categories<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
    <li><a href="http://soyum2222.github.io/tags"><i class="mdi-action-loyalty left"></i>Tags<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
  </ul>
  <div id="index-banner" class="parallax-container">
    <div class="section no-pad-bot">
        <div class="container">
            
            <h1 class="header center teal-text text-lighten-2">NOTHING</h1>
            <div class="row center">
                <h5 class="header col s12 light">好读码，不求甚解；每有会意，便欣然忘食。</h5>
            </div>
            <div style="padding-top: 150px;padding-left: 10px;">
                
                <a href="http://soyum2222.github.io" class="menu">HOME</a>
                

                
                <a href="https://github.com/soyum2222" class="menu">GITHUB</a>
                

            </div>
        </div>
    </div>
    <div class="parallax">
        
        <img src="http://soyum2222.github.io/images/default.png">
        
    </div>
</div>


<div class="container">
  <div class="section">


<div class="row">

  
  <div class="col m4 s12">
    <div class="card-panel">
      <h4><a href="http://soyum2222.github.io/defer/">defer 源码阅读 （go 1.13）</a></h4>
      <p>
       
      </p>
      <p>直接上代码  package main import &quot;fmt&quot; func main() { defer func() { fmt.Println(&quot;defer&quot;) }() } 反编译  &quot;&quot;.main STEXT size=113 args=0x0 locals=0x48 0x0000 00000 (defer.go:5)	TEXT	&quot;&quot;.main(SB), ABIInternal, $72-0 0x0000 00000 (defer.go:5)	MOVQ	TLS, CX 0x0009 00009 (defer.go:5)	MOVQ	(CX)(TLS*2), CX 0x0010 00016 (defer.go:5)	CMPQ	SP, 16(CX) 0x0014 00020 (defer.go:5)	JLS	106 0x0016 00022 (defer.go:5)	SUBQ	$72, SP 0x001a 00026 (defer.go:5)	MOVQ	BP, 64(SP) 0x001f 00031 (defer.go:5)	LEAQ	64(SP), BP 0x0024 00036 (defer.</p>
      <p>
      29 Aug 2020
       
      </p>
    </div>
  </div>

  
  <div class="col m4 s12">
    <div class="card-panel">
      <h4><a href="http://soyum2222.github.io/getip/">Golang 获取 IP 寄存器内容</a></h4>
      <p>
       
      </p>
      <p>之前用C写过一个调度器，想用Go也写一次，正好最近在学习Plan9汇编，趁机巩固一下。
先理清楚基本思路。因为不能直接对IP寄存器做操作，所以无法直接通过 MOVQ IP，AX 这种方式得到IP的值。
但是总所周知，CALL 指令等价于 PUSH IP ，jmp XXX 。所以我们可以通过CALL指令过通过SP寄存器拿到IP的值。
基本思路很简单
但是和C语言有一些细微的差别
C版本
int64 getrip() { register int64 ip; asm volatile ( &quot;movq 0x10(%%rsp), %0\n\t&quot; :&quot;=r&quot;(ip) ); return ip; } Go plan9 版本
TEXT ·getip(SB),$0 MOVQ (SP) ,AX MOVQ AX,ret+0(FP) RET C版本要比GO版本SP多偏移一个8字节。
为啥呢? 我照着C版本SP偏移8字节取拿IP，结果就是debug了一个下午。
反编译两个版本看一下
C
getrip: .LFB0: .cfi_startproc pushq %rbp .cfi_def_cfa_offset 16 .cfi_offset 6, -16 movq %rsp, %rbp .cfi_def_cfa_register 6 pushq %rbx .cfi_offset 3, -24 #APP # 9 &quot;main.</p>
      <p>
      27 Aug 2020
       
      </p>
    </div>
  </div>

</div>

  
<div class="row">
  <div class="col s3 m1">
  
    <a class="btn-floating btn-large disabled"><i class="mdi-navigation-arrow-back"></i></a>
  
  </div>
  <div class="col s6 m10 center">&nbsp</div>
  <div class="col s3 m1">
  
    <a class="btn-floating btn-large disabled"><i class="mdi-navigation-arrow-forward"></i></a>
  
  </div>
</div>


  </div>
</div>

  <footer class="page-footer">
    <div class="footer-copyright">
      <div class="container">
      © 2015 Copyright Text
      <div class="right">Design <a class="grey-text text-lighten-4" href="http://pdevty.github.io/blog/">pdevty</a></div>
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="http://soyum2222.github.io/js/materialize.min.js"></script>
  <script src="http://soyum2222.github.io/js/init.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  </body>
</html>
